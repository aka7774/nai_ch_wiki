* 画像の再現性

#contents

* ねらい

おおよそ3段階のレベルでの再現を考える。

- レベル1. 画像の作者が自分の環境で再現したい
- レベル2. 画像の作者が他人の環境で再現してもらいたい
- レベル3. 他人が画像の環境を再現したい

* レベル1. 画像の作者が自分の環境で再現したい

** 2度生成して完全に一致する画像が作れるか

- xformersを有効にしている場合は作れない
- 「a」のつくSamplerでは作れない
- VRAMが不足している場合に再現不能な画像が生成されることがある(要検証)

** 前に作った画像をアレンジしたい

[[生成差異の検証(Sampler編)]]と[[生成差異の検証(Anything編)]]によると
- ハードウェアに依存する(FP16への対応有無によるのかも知れない(要検証))
- GeForce RTX 2000番台以降であれば「ほぼ同一な画像」が生成できる

** テキストだけ残しておいて後日再現する

基本的には画像で残しておいたほうが安全。
テキストを抽出して画像は一旦削除、という容量節約は成り立ちにくい。

- 1111本体の仕様変更などがあるのでソフトウェア一式も保存しておいたほうが無難
- PNG Infoの情報が不完全である
-- 項目自体が足りない(VAE)
-- 項目は存在するが値(ファイル名)が環境に依存する(Embedding, LoRA, Hypernetwork)
-- コマンドラインオプションやハードウェアなどは保存されない

* レベル2. 画像の作者が他人の環境で再現してもらいたい

前提として、レベル1で問題になる条件を出来るだけ回避する。

** モデルの出自を明らかにする

sha256対応になり重複はしなくなったが、
1つのモデルでも変換方法が多岐にわたるため、
ハッシュからモデルを逆算することが難しくなっている。

- 使用したモデルの名称やURL
-- そもそも有名あるいは利用者の多いモデルを使ったほうが良い
-- モデル名は改名せず、「Add model name to generation information」をオンにする
- fp16、pruned、safetensors対応か
-- どのモデルかがわかれば違いは誤差程度で収まるはずだけど
- VAEを入れ替えたか、入れ替えたなら何か
-- 別途必要な場合は何が必要か
- 独自マージなら
-- 簡素ならマージ手順を伝える
-- 複雑ならマージ済みモデル自体を共有したほうが早い

** そのほかの情報を明らかにする

- HN, Loraを改名したなら元の名前やURL
-- これも出来るだけ改名しないで使うにこしたことはない
- 生成日時もヒントになる
-- あえて古いバージョンを使っているならgitのhashも記載する
- ランダム構文{A|B|C}を使ったなら、Dynamic PromptsをオフにするとPNG Infoに{}が残る

* レベル3. 他人が画像の環境を再現したい

- ハッシュからモデルを検索する
-- モデル名はデフォルトの設定では記録されない
- HN, Loraの名前から推測する
- VAEはあるものをすべて当てはめてみる?

画像からモデルを推測するソムリエも出現しはじめている・・・。
