言葉がおかしい理由は[[用語集]]を見てもらうとして、
Stable diffusion webui (automatic1111)をColabなどのクラウドGPUで動かす話。


#contents

* どんなサービスなのか？

月額や時間ごとにお金を払って（もしくは無料で）GPUの載ったサーバを遠隔で使わせてくれる。
うまく使えば高いGPUを買わずにローカル版を遊べる。学習もできる。
サブスクなので高性能PCを買う金銭的余裕がなかったり、PC知識がなく選ぶのが怖いという人でも少ない初期投資で低リスクに始められることがメリット。
一方でレンタルして使う形になるので、サービスによるが使用時間を気にする必要があったり、スペックや操作性の自由度が低いことなどがデメリット。

サービスの形態はサービスによって異なる。
大きく分けてマシンごと貸す自由度が高くて値段が高いタイプと自由度が低くて制限があるが値段が安い型がある。
前者の代表例として、GCP Compute Engine、AWS EC2、Vast.ai、runpodなどがある。後者の例としてGoogle Colaboratoryやその派生のPaperspace Gradientがある。
前者では基本的には通常のPCを持つのと同様の自由度が高い運用ができる。ただし基本GUI（デスクトップ上でマウスカーソルぽちぽち）がなく、CUIによる操作（文字でコマンドを入力して操作）がほぼ必須で使用にはlinuxの知識も求められる。
後者の場合はJupyter notebookというpython用のインターフェースでの操作が基本で主に機械学習やデータサイエンス領域の研究用に機能が特化している。通常マシンの連続起動時間に制限があったり、シャットダウンごとにデータがリセットされるストレージが基本だったり制限がある分料金が抑えられ、環境構築の手間等も少なくなっている。

* 注意すること

ローカルは諸々自己責任だが、
クラウドでやる場合、運営に見られてるかもしれない。
違法性の高い行動を行なっていればサービスの利用を制限されたりBANされる可能性もある。

* クラウドサービスの検討

** Colab (Google Colaboratory)

- https://colab.research.google.com/?hl=ja

- ''&color(#ff0000){2023年4月21日以降、無料プランでのstable-diffusion使用が禁止になりました。}''
-- &color(#ff0000){有料プランでは動きます。したがってcolabを使用する場合は課金必須になりました。}

%%無料版で使える%%[[入門用Notebook]] があるので試してみてください。

Pythonのバージョンは3.8だが、3.10まで上げることができる。
xformersをコンパイル無しで動かせるcondaがおすすめ。

RAMが少ないので、でかいモデルのマージでエラーになるらしい。
(メモリさえ積んであればローカルでやれる)

//*** 無料版
//
//- メモリ 12GB程度
//- VRAM 15GB程度(たぶん毎回T4が引けるはず)
//- 基本（起動ごとに消える）ストレージ 60〜100GB程度
//- 永続（起動ごとに消えない）ストレージ なし(Google Driveが使える 無料だと15GB)
//- ノートブックを90分操作しないと切断(定期的にcaptchaあり)
//- 連続12時間使用すると切断(12時間の使用が保証されているわけではない)
//
//画像生成は出来る。速度は3060の半分程度。
//4GBまでのモデルなら学習もギリギリできる。[[ローカルの学習入門]]
//学習済みのモデルなど、大容量のデータはDriveに移すのが定石。
//
//ヘビーに使ってると急に切断される。
//&ref(https://image02.seesaawiki.jp/n/h/nai_ch/YNWei0mtOm.jpg)
//こうなるとおよそ24時間使えなくなる。
//
*** 有料版 Colab Pro/Colab Pro+
NovelAI 本家のように毎月ポイントが与えられてポイントを払ってコンピュータを使う仕様。
3つの性能の違うインスタンスがある。
性能の違いについては[[PCスペック相談室>https://seesaawiki.jp/nai_ch/d/%a5%ed%a1%bc%a5%ab%a5%eb%c9%f4%a1%a1PC%a5%b9%a5%da%a5%c3%a5%af%c1%ea%c3%cc%bc%bc]]を参照。
T4 21円/時間
V100 57円/時間
A100 140円/時間

Colab Pro 月額1072円
毎月100CU付与

Colab Pro+ 月額5243円
毎月500CU付与


*** 有料版 Drive

月額250円で容量が100GBになる。(15+100GBではない)
&color(#ff0000){繰り返すが、ここに違法なファイルや国際的に問題のある画像を置いてはいけない。}

** Paperspace gradient
従量課金でなく月定額制なGoogle colab類似のサービス。安価な代わりに、GPUが借りれない時間が多かったり不安定な場合がある。
現在良いGPUを引きにくくなっている。
- https://www.paperspace.com/gradient

*** 無料版

- VRAM 8GB
- 基本（起動ごとに消える）ストレージ：不明
- 永続（起動ごとに消えない）ストレージ：5GB

*** 有料版
8ドル/月プラン
使用可能GPU：RTX4000、RTX5000、A4000等（時間帯によっては利用者多数のマシンは使えない）
- 基本（起動ごとに消える）ストレージ ：不明
- 永続（起動ごとに消えない）ストレージ：15GB

39ドル/月プラン
使用可能GPU：A5000、A6000、A100(VRAM 80GB)等（時間帯によっては利用者多数のマシンは使えない）
- 基本（起動ごとに消える）ストレージ ：不明
- 永続（起動ごとに消えない）ストレージ：50GB

障害が多く、良いGPUを引きにくくなっているのでお勧めしない。
アフィ経由で登録した人は、紹介者に使い方を聞きましょう。

** Huggingface Hub

ストレージ容量対策。

ckptダウンロードする時に使ってるはずのサイト。
モデルをアップロードできる。
マージモデルやDreamboothなどの大容量データに便利。
数行のコードで出来るのでNotebookにセルを追加するのが便利。
以下の方法だと1ファイル5GBまで。
gitを使う方法もある。
https://huggingface.co/docs/huggingface_hub/how-to-upstream

114スレ625

=|BOX|
今80gbくらい使ってるけど何も文句言われんで&#9786;
やり過ぎるとある日突然banされるとかはあるかもしれんけど 

from huggingface_hub import upload_file
upload_file(path_or_fileobj="アップロードするファイル", path_in_repo="保存名", repo_id="ユーザー名/リポジトリ名", token="トークン")

/tmp/hoge.ckpt を foo ユーザーの bar リポジトリ上の huga ディレクトリにアップロードしたい場合はこうする

from huggingface_hub import upload_file
upload_file(path_or_fileobj="/tmp/hoge.ckpt", path_in_repo="huga/hoge.ckpt", repo_id="foo/bar", token="トークン")

トークンは書込み可能なものを発行する
読み込み限定だと404エラーが出る 
||=

** 他のサービス

- runpod: 最初のころ少し話題になった安価なクラウドGPUサイト。有料。値上げした?
- vast.ai: 個人のGPU/Storageを貸し借りできる。他の同等のサービスと比較して安価。
- AWSとかAzureとか: 値段が凄く高くなるので非推奨。

