#contents

*概要
ローカル環境(AUTOMATIC1111 Stable Diffusion WebUI reForge)の導入ガイドです。
オリジナルの1111は古いので、ここではフォーク版のreForgeを導入します。
なお、GeForce RTX搭載PCを対象としたガイドです。

*導入

** 1. Python 3.11.9をインストールする
&color(#ff0000){Anaconda入れてたら先にアンインストールしろ!!!}

[[https://www.python.org/ftp/python/3.11.9/python-3.11.9-amd64.exe]]

「python-3.x.x-amd64.exe」がダウンロードされるので、ダブルクリックで開く。
このとき、Add to PATH にチェックをつけてインストールすること。
&ref(https://image02.seesaawiki.jp/n/h/nai_ch/H089Tt3hem.png)

&color(#ff0000){インストール終わったらPC再起動、絶対に!!}

** 2. Gitをインストールする

必須だと思った方がいい。

[[https://git-scm.com/downloads]]
64-bit Git for Windows Setup. を選ぶ。

インストールするときは、「Windowsエクスプローラの統合 - Git Bash」のチェックボックスをオンにするのがおすすめ。

** 3. reForge本体のダウンロード
※ダウンロード先は''SSD推奨''。HDDだと起動時間やモデルの切り替え時間が非常に長くなるので注意
（空き容量が心配ならSettings > Paths for savingから生成画像の保存先を別ドライブにするなども可）

以下の手段から好きなものを選んでWebUIのデータをダウンロードしてきます。
��WebUIをZIPでダウンロードする：お試しで環境を構築したい人向け
��Github Desktopをインストールする：アプデを行いながら使っていきたい人向け：&#128304;おすすめ!
��Gitを使う：アプデしたり差分を確認したりバージョンを戻したりとなんでもしたい人向け

***��WebUIをZIPでダウンロードする場合
GithubリポジトリからZipでダウンロードするかんたんな方法。アプデとかめんどくさいし、バージョン戻しもできないのでお試し環境構築用として推奨。
+ 以下のURLアクセス ~~ https://github.com/Panchovix/stable-diffusion-webui-reForge
+ Code <> →Download ZIP　でダウンロードします
+ 好きなところに配置
+ 完了

***��Github Desktopをインストールする場合：&#128304;おすすめ!
グラフィックインタフェースで操作できるGitです。
黒い画面をみなくてすみます。アプデが簡単にできる環境が作れるけど、バージョン戻しには別途Gitをインストールする必要があります。

+ Github Desktopをインストールする
+ File　→　Clone Repository
+ タブ「URL」に設定後、以下を記載~~
=|BOX|
https://github.com/Panchovix/stable-diffusion-webui-reForge
||=
+ Local Pathに配置したい場所を記載してCloneを押す
+ 完了

&ref(https://image01.seesaawiki.jp/n/h/nai_ch/A2FTwb_lRZ.jpg,450)

***��Gitを使う場合
なんでもできる。さいつよ。

1. エクスプローラーとかでインストールしたいディレクトリを開く
2. 任意の場所を右クリックし、「Git Bash here」を選択します
3. 黒い画面が出たらディレクトリのパスが表示されていることを確認します
4. 次のコマンドを打ちリポジトリをダウンロードします
=|BOX|
git clone https://github.com/Panchovix/stable-diffusion-webui-reForge
||=

**4：モデルのダウンロードと配置

- ここで検索する
-- https://huggingface.co/models
- モデルについては[[SDXL]]ページに詳しく書いてある。
- [[civitai>>https://civitai.com/]]もモデルが沢山あるのでおすすめ。
- ダウンロードしたファイルは以下のディレクトリに配置する
-- webui/models/Stable-diffusion

**5：VAEのダウンロードと配置(任意だけど推奨)

- VAEがないと色が薄くなったりNaNエラーになったりするので別途指定推奨
https://huggingface.co/madebyollin/sdxl-vae-fp16-fix/tree/main にあるsdxl_vae.safetensorsをDLする
- 配置方法
-- webui/models/models/VAE に配置して、ファイル名を選択して適用する
- 設定の場所は、Settingsタブの[Stable Diffusion]-[SD VAE]

**6：配置
以下のディレクトリにモデルを配置します。
Checkpoint:
/webui/models/Stable-diffusion
VAE:
/webui/models/VAE

**7.起動確認

ここまでの手順がうまくいってれば起動するはず。

''「webui-user.bat」をダブルクリックでWebUIを起動させます。''
図：これね
&ref(https://image02.seesaawiki.jp/n/h/nai_ch/y4M3qrylYT.jpg)

webui-user.batを実行するとターミナルが開き、モデルデータや色々な必要モジュールの読み込み状況が文字で表示される。
初回起動時は様々なプログラムのセットアップ作業が行われるのでしばらく待つ。
&color(#ff0000){結構時間かかるんで気長に待ちましょう}
&ref(https://image02.seesaawiki.jp/n/h/nai_ch/yiFEf9KQqg.png)
Running on local URL: http://127.0.0.1:7860
と表示されたら、インターネットブラウザ（Chrome,Edge,Firefox等）のアドレス欄にhttp://127.0.0.1:7860と打ち込む。
WEBUIの操作画面が表示されたらここまでの手順は成功。おつかれさまでした。

**8(※オプション)：環境設定
https://github.com/Panchovix/stable-diffusion-webui-reForge/blob/main/README.md#forgereforge-backend

* 簡易インストール
** StabilityMatrix

https://github.com/LykosAI/StabilityMatrix

WebUI Easy Installer and Launcherの代わりになるかもしれない。

* UIの日本語化
+画面上部メニューの「Extension」タブをクリック
+Installed,Avaliable,Install from URLと書かれた中の「Avaliable」をクリック
+「localization」の左側のチェックマークをクリック（チェックを外す）
+「Load from:」ボタンをクリックしてしばらく待つ
+表示されたExtensionリストの中から「ja_JP Localization」を探して、右側にあるInstallボタンをクリック
+画面上部メニューの「Settings」タブをクリック
+画面左のメニューの中から「User Interface」を探してクリック
+画面右側に表示された各種設定の下の方にある「Localization (requires restart)」の「None」の所をクリックして「ja_JP」にする。
+画面上の方にある「Apply settings」を押す。
+1 settings changed: localization.　と表示が出たら画面上の方にある「Reload UI」を押す。


* バージョンを戻す方法
アプデしておかしなっても大丈夫やで

** git checkoutを使う方法
参考：(英文)：Git revert guide - [[https://rentry.org/git_retard]]

** クリーンインストール
+ リソースのダウンロードとかは省いて導入ガイドにそってWebUIを再インストールする。~~ ※フォルダは「StableDiffusion_WebUI_v2」とか名前つけて新しく作ってリポジトリをクローンするんやで
+ もとのディレクトリ*に置いてあったモデルを同じディレクトリにコピペする ~~*場所：/webui/models/Stable-diffusion
+ 完了

* 移動する方法

SSDを増設したとかで、
C:\stable-diffusion-webui-reForge
から
D:\stable-diffusion-webui-reForge
に移動したいとする。

基本的にはフォルダごと移動して大丈夫。
PythonとGitがCドライブに残ったままならこれでいけるはず。

Pythonの置き場所も変わる場合、
webui\venv\pyvenv.cfg
を開いて、homeを変える必要がある。

* 削除する方法

WebUIのディレクトリごと削除する。

ターミナルでpip cache purgeでpipキャッシュを消去する。

PythonとGitをインストーラーで入れた場合はアンインストーラーで消す。
Pythonの残骸がC:\Users\ユーザー名\AppData\Local\Programs\Pythonにあるので消す。




