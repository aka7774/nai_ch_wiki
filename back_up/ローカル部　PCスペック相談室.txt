&size(20){ハローアスカベンチマーク(GPUごとの生成速度の一覧)は[[helloasuka]]に移転しました}
- GPUの検証一覧(wiki内別ページ)
-- [[ハローアスカ(生成ベンチマーク)>helloasuka]]
-- [[ハローカエル(LoRA学習ベンチマーク)>hellofrog]]
-- [[GPUによる生成差異の検証]]

#contents

* はじめに

- &size(28){''&color(#ffef00,#000000){ゲーミングノートパソコンは絶対に買うな}''}
ノーパソ用はでかいPC用のグラボと型番がすごい似てたりするけど性能は全然違うで。
同じ型番でもデスクトップPC用より低性能でコスパが悪いので、GPUぶん回す用途はデスクトップPC一択や。
- &size(20){''&color(#ffef00,#000000){脳死でRTX4090とか勧めるな}''}
PC触ったことないやつが何十万もするグラボ買うのは常識的ではないで。5万円の3060はまだしも30万円の4090を素人に勧めるのはおかしいと思う。
&size(10){(ワイは仮想通貨が流行ったときに、専門家も立ち入らないような魔境取引所ににわか一般人が入り込んで草コインがどうのこうので爆死していったのを見たから同じことを繰り返してほしくないから書いてるで)}
他人の意見に左右されず自分の環境にあったグラボ/PCを買おうな(=もちろん90番台のグラボがベストなニキもいるってことや)。
- &size(20){迷ったらRTX 3060を買え}
万人向けのGPU。5万円程で比較的安価ながら、12GBのメモリを搭載していてそこそこの性能でAI用途ではコスパ最高。
もちろんゲームもFHDなら快適やで。

* 注意

** RTX40シリーズの注意事項

補助電源コネクタの異常発熱により融解することがある
[[NVIDIA公式の調査結果>>https://nvidia.custhelp.com/app/answers/detail/a_id/5413]]によると、コネクタが完全に挿入されていないことが原因
購入者はコネクタをしっかり差し込み、確認すべき

torch1系の場合、cudnnライブラリの更新をしないと速度が出ないっぽい。
[[ローカル高速化メモ]]

** メーカー・モデルによる差異

PC一般の知識ではあるが、同じ型番でもメーカー・モデルによって性能が異なる。
例えば、底辺のRTX4090だと最上位のRTX4080より低いベンチマークスコアを出すこともある。
特に組み立て済みPCでメーカー・モデルが明示されていない場合、一番安上がりのグラボを押し付けられる可能性が高い。
そもそも自作とBTOの差が縮まってきているとはいえ、それでも最上位だと10万以上上乗せされている。
ハイエンドほど自作推奨だが、どうしても組み立て済みPCを買う場合は、特にグラボについてはよく調べてから選んだほうがよい。
* パーツ評

** GPU

基本的にGPUの世代が新しく、メモリ帯域幅が多いほど生成が速くなる。
なお、メモリ容量やシェーダー数が多いからと言って速いわけではない(RTX3060が最たる例)。

RTX 2060 6GB以上を推奨。理由はFP16演算が速いから。
ベンチマークの結果もここで3倍程度の壁が出来ている。
将来的にTensorRTによる高速化もありうる、かも。

学習は、処理速度もVRAMもあればあるだけ良い。
VRAM 8GBでも学習できるが解像度が欲しくなる。3060 12GBは評価が高い。

Radeon、Intel Arc、Macでも動作はするが新規購入はお勧めしない。
ケチるんならGeForce GTX 1000番台の中古。ただしRTX系のGPUより数倍遅いし、学習も厳しい。

ちなみにGeForce GTX 600番台(一部の780番等も該当)のKeplerやそれ以前のFermi世代はCUDAがサポート対象外で、LinuxでTorchを手動でビルド(エラーが発生しやすい)しないと使えないので注意。(誰もいないとは思うが...)

検証記事 [[【Stable Diffusion】AIイラストにおすすめなグラボをガチで検証【GPU別の生成速度】>>https://chimolog.co/bto-gpu-stable-diffusion-specs/]]

** RAM(メインメモリ)

モデルのマージ、WSL2、学習のいずれかに手を出すなら32GB以上が推奨。
速度はそこまでシビアではない。
RamDisk(仮想メモリ,スワップ領域)はほぼ意味ないが、SuperMergerのためにメモリを余分に(モデル3つ分くらい)積むのはアリ。また、RAMが少ないPCで発生するフリーズし続ける状況を一応回避できる。

生成だけならモデルの容量を小さくすることで節約が可能だし、無料Colabを使ってモデルを小さくする便利なNotebookもある。

生成だけなら8GBでもギリギリ動作するが、モデルデータの読み込み時や初回起動時にPCが一瞬か一定時間フリーズする。

** CPU

上位ではCPUがボトルネックになる。
下位はSandyおじさんでも動いてるが多少遅い。DDR3世代だから？
推定12it/sまでは出せるのでGPUの性能ぎりぎり間に合ってるけど、次の生成開始に時間がかかってるのかも。

よほど古くない限り、Intel/AMDどちらでも問題ない。どっちでも何も変わらない。

GPU性能をフルに発揮し、処理中に他の作業がしたいなら、
iGPUつきのCPUにして、ブラウザ等はiGPUに割り振るのがおすすめ。
デスクトップCPUはIntelであれば末尾にFがついてないもの、AMDは末尾にGがついてるものとRyzen 7000シリーズがiGPUを搭載している。

処理速度が18it/s以下ではほとんど影響しないが、18it/sを超えたあたりから急激にシングルスレッド性能によるボトルネックが出やすくなる
目安としてCinebench R23のシングルコアのスコア×0.0176でそのCPUの最大速度がわかる

** ストレージ

1111の起動時間が気になるなら出来るだけ速いNVMeのSSDがおすすめ。
待ってもいいならSATA SSDでも支障はない。
消耗はそこまで問題にならなくなったはず。
総書込量(TBW)を使い切る前に経年劣化で壊れるほうが多い。

バックアップを兼ねて2つ目のストレージを持っておくと安心。
コスパ的なおすすめは6〜8TBくらいのHDD。USBの外付けとかでもいいと思う。
速度重視のためにSSDオンリーにするのもいい。
モデルとデータセットについてはHuggingFace&#129303;が受け入れてくれる。
(プロバイダーによっては大容量アップロードで警告が来るらしいので注意？)

個人輸入、保証なし、超高額(960GBが6万円!!)、AMD環境で動作しないのでおすすめしないが、Intel製SSDのOptane 905pもアリかも。
異次元の10000TBを超える耐久性があり、何をしても性能が下がらないので激しい書き込みをする用途にうってつけ。

** OS

ガチでやるならLinuxは良い。
Windowsで普段使いするならWSL2も良い。
なお、Linuxだからといって速くなるとは限らない。

** クラウドとの併用

生成はローカル、学習はクラウドという構成もアリ

- LoraとHNの学習結果は容量が少ないのでクラウドからダウンロードしやすい
- 学習中は生成もゲームも出来なくなるし電気代もかかるのでクラウド化は合理的
- GPU買う前にまず無料Colabを試してみよう [[ローカルの学習入門]]

*実際の所どれ買えばいいの？

** A. お前の予算が許す限りのNVIDIAの上位モデルを買え
[+]
- RTX 4090
3090Tiの1.5倍以上の性能をもつ次世代の化物
超重量級ゲームのCyberpunk 2077を4Kウルトラ設定で72fps(3090は44fps)という圧倒的性能で
パストレーシングか8Kが実用化されるまで向こう10年は使える(耐久性は考慮しない)
そのスペックもさることながら、本体がとても大きいため冷却性能が優れており
高負荷でぶん回すAI画像生成と非常に相性が良い
30万円もするだけあって、あらゆる分野で最強
予算が許すなら是非とも購入すべき
ちなみに4080以下のスペックと価格帯が微妙すぎて、相対的に高コスパグラボという評価になってきている


- RTX 4080
3090Tiと同等の値段、より少ない電力で3090Tiを超える性能を発揮する
4090に匹敵する大きさで冷却性能が優れており、高負荷でぶん回すAIと非常に相性が良い
4090か4080のどっちを買うか悩んでてコスパ優先ならこちらがオススメ
VRAMは16GBあり、ほとんどの場面で不足することはない


- RTX 4070Ti
RTX 4080からVRAMやCUDAコアを減らした廉価モデルで価格的にも性能的にも3080の後継モデル
3090Tiを越える性能を誇り3090より安価だが、VRAMが12GBなので高VRAM狙いだと少し残念。あと4Kゲーム性能が伸び悩み、3090Tiに負けるのも気になる。
VRAM12GBの3060以上の性能を求めて3080を考えている人なら、価格の近いこちらがお勧め
AI生成的にメモリ容量の3090と生成速度の4070Tiのどちらが良いか悩ましい、期待の新モデル


- RTX 4070
RTX 3080より少ない電力で同等の性能でより安い。VRAMは12GBあるのでLoRAの1024での学習もできる。
TGPは200Wで、2060S,2070Sからのアップグレードにおすすめ。
もう少し値段が下がれば3060(12GB)の置き換えになる、かもしれない


- RTX 4060Ti(16GB)
2倍のメモリ容量になってバス幅が半分(128bit)に削られた3070といったところ。
3060より数万円高いのがネック。
2023年7月発売予定


- RTX 4060Ti(8GB)
ゲーム用途でも3070Tiに勝ったり負けたり、物によっては3060Tiにも勝ったり負けたりの超微妙スペック。
性能的にも価格的にも、これを選ぶなら3060 12GB を選びましょう。


- RTX 4060
TGPがわずか110Wなのが魅力的だが、VRAMが8GBで性能も3060相当。
AI用途では引き続き3060 12GBがおすすめ。
2023年7月発売予定


- RTX 3090Ti
性能とワッパで4090どころか4080にすらボロ負け
今更これを買う意味は全く無い
4090か4080を、VRAM24GB欲しいなら3090を買え


- RTX 3090
VRAM24GBの現世代機の化け物
値段相応のスペックを持ち、VRAM12GB以上を狙うならこれ一択
ゲームでもAI学習でも何でも十分にこなす優等生
RTX30のハイエンドはメモリの温度に要注意。
だが値上がり傾向にあるので、値段次第で4090か4080のほうがいい。生成メインなら4070Tiでいい。


- RTX 3080Ti,3080
4070,4070Tiが値下がりしている上、性能やワッパを考慮すると今更新品で買う価値はない。
中古なら、マイニング落ちの10GBに釣られてLHR対応の12GB版の中古がかなり安い。


- RTX 3070、RTX 3070Ti
4K60fpsも可能だが、DLSSがないと安定して60fpsを出せず、絶妙な性能不足を感じるシーンが多い。
快適な4KゲーミングやVR目的なら4070を買った方が良い。
AIの学習はしない、4Kがある程度動けばいいという人か、WQHDモニターで使うならオススメ


- RTX 3060Ti
3070より遅くて3060よりVRAMが少ない中途半端な存在。3060 12GBでいい。


- RTX 3060(12GB)
迷ったらとりあえずこれ買おう
VRAMが12GBもあるのでDreamBoothが使えたり正にクリエイターの為のスペック
フルHDであれば最新のゲームも快適
ちなみにPS5とほぼ同じ位のスペック
後述の8GB版と間違えて買わないように注意


- RTX 3060(8GB)
''絶対に買うな''
最近出てきた新型だが、''VRAMが8GBに減ってしまった''罠モデル。
性能は12GBのほうが高く、価格も安いという逆転現象が起きている
ゲームをするなら3070系、AI作成なら3060(12GB)がお勧め


- RTX 3050
自分を最新版超絶性能グラボだと思い込んでいるGTX 1660Ti
とりあえずグラボを乗せたい人向け。
一時期は高騰して5万などと分不相応な値段で売られていたが、3万円台前半なら普通にアリ。


- GeForce GTXシリーズ全般
ゲームではそこまで差がなくても、AI関連ではRTXに数倍の差をつけられるほどに遅い
ゲーム専用GPUといったところ。


- (番外編)RTX A4000
''VRAM16GB''で実売価格でRTX 3080Ti程度(?)で手に入る(3DCG等の)''クリエイター向けGPU''。
実売価格の割にゲーム用途ではやや弱い(概ねRTX 3060〜3060Tiの間くらい)が''1スロット''且つ''140Wという驚異のワッパ''を兼ね備える。
''元々ゲーム・一般ユーザ向けじゃない''ためパーツ屋に行っても置いてないのが基本。買うなら通販など調べよう。
一般的なゲームとの相性はあまり良くないがVRCなどではVRAMのお陰で快適らしい。
繰り返すが''元々ゲーム・一般ユーザ向けじゃない''。入手手段から固有の問題まで自己解決できる自信のある上級者向け。


[END]

** A. どれを買うかで迷ってるなら3060 12GBを買え
[+]
理由は5つ。
- 法外というほどの高額じゃない(※個人の感想です)
- VRAMあたりのコスパとワッパがいい。650W電源くらいで動く。
- 学習するのにVRAMが必要だから。今は興味なくても後でしたくなるかも知れない。
- 生成する時に高解像度で出したくなるかも知れないから。Highres. fix
- VRAM容量的にこれがダメなら3090や4080が必要になるから。

TDPなどスペックの参考に
https://wikiwiki.jp/nvidiavga/GPU%E4%BB%95%E6%A7%98%E4%B8%80%E8%A6%A7%E8%A1%A8

RTX 3060(12GB)搭載PCは、PCショップで15万前後で買える。GPU単体なら5万前後。
15万出すなら有名なショップで新品買ったほうがいいと思うぞ。
間違って3060 8GBを買わないように。3060Tiも8GBだから損。
起動時とモデルマージ時にメインメモリを激しく消費するので、なんとかして32GBに増設したほうが安心。
[END]

** A. 3050 8GBを検討？
[+]
2023-02-26現在、かなり値上がりしてしまった(3万円台後半)ので新規購入はおすすめしない。
この価格差ならあと1万だして3060 12GBを狙いたい。

- LoRAの登場でVRAM 8GBがギリ人権を得られる
- 3060の1.5倍待てば済むんなら・・・待てない？
- 8GBあればmedvram無しでも1024x768くらいは余裕
- 生成される画像が違う？(検証求む)
- 新品の2000番台は無くなりつつあるので3050が最下限になる
> NVIDIAは、GeForce GTX 1660、GTX 1660 SUPER、RTX 2060、RTX 2060 SUPERの4製品の製造を終了した。

中古なら2060 12GB、2060S(8GB)もアリ。
1060とか1660Tiは数倍遅くなるのでVRAM容量を置いといてもナシかな。
とはいえ1060とか1660Tiから3050に買い換えるのも悲しいけど。
[END]

** A. 学習するかどうかから考えて買え
[+]
-学習はLoRAだけする
VRAM8GBのモデルのうち予算内の上位モデルを狙おう
候補：RTX 3070,3070Ti,4070

-学習にちょっと興味があるか、FHD以上の解像度で生成したい
VRAM12GBのモデルを選ぼう
候補：3060(12GB)・3080(12GB)・4070Ti

-学習に大変興味がある
VRAM16GB以上のモデルを選ぼう
候補：3090、4090、4080
[END]

** 中古のグラボ買っても大丈夫？
[+]
基本的には推奨しない。
中古に流れているグラボの大半は、マイニングに使われてたと言われている。
マイニングはグラボの性能を全力で使う為、熱の影響でコンデンサや他のパーツが劣化してる可能性がある。つまり故障しやすい。
マイニングに不向きなLHR版(Lite Hash Rate)のグラボもあるので、そちらを買うと多少マシと言われている。
[END]

** ゲーミングノートパソコンをお勧めできない理由
[+]
Stable Diffusion webUIはマイニング並みに使用率100パーセントに張り付いた状態でグラボを酷使する
''ノートパソコンごときの冷却性能では全く冷えない''上にファンがうるさい

3070ならVRAM 8GBでデスクトップと同じになるが、
予算としては3060 12GB搭載デスクトップより高くなる。

3080や3080TiにはVRAM 16GBモデルがあり魅力的だが、
どんなに安くても30万円台なので、もう少し足せば3090搭載デスクトップに手が届く。

冷却性能の悪さやノートパソコン特有のGPU性能低下は、
寝てる間に絵を量産したり学習に丸一日かけてた時代が終わったこともあって、
AI絵ではそこまで大きな問題にならないが、単純にコスパは悪い。
[END]
** ローコストお絵かきAIPCを組む：中古相場とPC自作を使って
高みを目指すのもいいけど、俺と一緒にチープなスリルを味わおうぜ!

[+]
(1)オークションやフリマアプリ等を使って、適当に以下を調達する
- グラボ(アスカベンチ表を見て好きなのを選ぶ)
- マザボ(CPUの規格に合うもの)
- CPU
(2)Amazon、Tsukumo等で新品のパーツを調達する
- PCケース(規格はATX対応のもの)｜￥5,000
- CPUクーラー(CPUの規格に合うもの)｜￥3,000
- ストレージ(OS & 学習モデル配置用)：SSD 1TB｜￥6,000
- ストレージ(データ保管用)：4TBのHDD｜￥10,000
- メモリ(32GB)｜￥10,000
- 電源(750W, GOLD)｜￥15,000

※以下パーツのサンプル

▼グラボ
(1)GTX1070またはGTX1660 ｜￥15,000前後
GTX16xx系は半精度浮動小数点演算に対応していない影響で生成画像が緑か黒一色になる問題があるけど「--medvram --no-half --xformers」すれば別に普通に使える。RTX系の人と生成結果が微妙に一致しないけど細かいことは気にしない。
Highres.fixで1536x1024出すと1枚3分とかかかるがプレビューを眺めながら茶を頂くのも乙。

(2)RTX2060 12GB｜￥27,000前後
AI板で人権が得られるらしい

▼CPU
Ryzen5 2600X｜￥6,000

▼マザボ
ROG CROSSHAIR VI HERO AM4 マザーボード｜￥12,500 (ブランドは適当)

----

▼サンプル価格：俺のチープなスリルPC(RTX2060 12GB版)
※一般人
- RTX2060 12GB(中古)｜￥27,000前後
- ROG CROSSHAIR VI HERO AM4 マザーボード(中古)｜￥12,500
- Ryzen5 2600X(中古)｜￥6,000
- PCケース(規格はATX対応のもの)｜￥5,000
- CPUクーラー(CPUの規格に合うもの)｜￥3,000
- ストレージ(OS & 学習モデル配置用)：SSD 1TB｜￥6,000
- ストレージ(データ保管用)：4TBのHDD｜￥10,000
- メモリ(32GB)｜￥10,000
- 電源(750W, GOLD)｜￥15,000
合計：￥94,500


▼サンプル価格：俺のチープなスリルPC(GTX1070またはGTX1660版)
※土台はしっかりAIエンジョイ派
- GTX1070またはGTX1660(中古) ｜￥15,000前後
- ROG CROSSHAIR VI HERO AM4 マザーボード(中古)｜￥12,500
- Ryzen5 2600X(中古)｜￥6,000
- PCケース(規格はATX対応のもの)｜￥5,000
- CPUクーラー(CPUの規格に合うもの)｜￥3,000
- ストレージ(OS & 学習モデル配置用)：SSD 1TB｜￥6,000
- ストレージ(データ保管用)：4TBのHDD｜￥10,000
- メモリ(32GB)｜￥10,000
- 電源(750W, GOLD)｜￥15,000
合計：￥82,500

▼俺のチープなスリルPC v2　(RTX2060 12GB版)
※節約堅実派
- マザーボード(B450 AM4)(中古)｜￥5,000
- RTX2060 12GB(中古)｜￥27,000前後
- Ryzen5 2600X(中古)｜￥6,000
- メモリ(16GB)｜￥5,000
- 電源(750W, BRONZE)｜￥10,000
- ストレージ(OS & 学習モデル配置用 & データ保管用)：1TBのSSD(SUNEAST)｜￥6,000
- PCケース(規格はATX対応のもの)｜￥5,000
- CPUクーラー(CPUの規格に合うもの)｜￥3,000
合計：￥67,000

▼俺のチープなスリルPC v2 極み (GTX1070 8GB版)
※漢
- マザーボード(B450 AM4)(中古)｜￥5,000
- GTX1070 8GB(中古)｜￥15,000
- Ryzen5 2600X(中古)｜￥6,000
- メモリ(16GB)｜￥5,000
- 電源(Antec 650W電源 NE650C 80PLUS BRONZE)｜￥7,830
- ストレージ(OS & 学習モデル配置用 & データ保管用)：1TBのSSD(SUNEAST)｜￥6,000
- PCケース(規格はATX対応のもの)｜￥5,000
- CPUクーラー(CPUの規格に合うもの)｜￥3,000
合計：￥52,830

▼備考
OSの起動、アプリの起動、モデル読込とありとあらゆる読込が激遅になってストレスマッハなのでおすすめしないが、スリルを高めるにはすべてHDDでもいい。
「俺はNAIしか使わないぜ!」という漢気があれば何も問題はない。

[END]

** 中古の1000番台なら
[+]
コスパは1070が一番いいと思う。
FP16対応が限定的なのでVRAMを食う。
CPUをケチってiGPUが無いのでVRAMを食う。
というわけでVRAMは多めに欲しい。
1080とは大差ないが、1060だとかなり遅くなる。
[END]

** ローエンドGPUのVRAMと画像サイズ
[+]
FHDでHighres, fixしたかったら3060がおすすめやでー

PCの使用状況やライブラリ,ドライバのバージョンによってはこれより小さくなるかも。
モデルを小さくしてVAEを交換すれば高解像度を狙える。プログレスバーが100%あたりでCUDA OOMするときはMultiDiffusionのTiled VAEを使うといい。
|~VRAM|Options|最大WxH|
|4GB|lowvram|512x768|
|6GB|medvram xformers|1536x1024|
|8GB|xformers|1920x1088 1472x1472|
最大WxHを超えると出力画像が真っ黒(NansException)になるか、メモリ不足でエラーになる。
Unetが原因でNansExceptionが出るなら多分VRAMが足りてない。

medvramはだいたい所要時間1.5倍くらい
lowvramはさらに4〜10倍くらい
[END]

