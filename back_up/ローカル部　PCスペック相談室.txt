&size(20){ハローアスカベンチマーク(GPUごとの生成速度の一覧)は[[helloasuka]]に移転しました}
- GPUの検証一覧(wiki内別ページ)
-- [[ハローアスカ(生成ベンチマーク)>helloasuka]]
-- [[ハローカエル(LoRA学習ベンチマーク)>hellofrog]]
-- [[GPUによる生成差異の検証]]

#contents

* はじめに

- &size(28){''&color(#ffef00,#000000){ゲーミングノートパソコンは絶対に買うな}''}
ノーパソ用はでかいPC用のグラボと型番がすごい似てたりするけど性能は全然違うで。
同じ型番でもデスクトップPC用より低性能でコスパが悪いので、GPUぶん回す用途はデスクトップPC一択や。
- &size(20){''&color(#ffef00,#000000){脳死でRTX4090とか勧めるな}''}
PC触ったことないやつが何十万もするグラボ買うのは常識的ではないで。5万円の3060はまだしも30万円の4090を素人に勧めるのはおかしいと思う。
&size(10){(ワイは仮想通貨が流行ったときに、専門家も立ち入らないような魔境取引所ににわか一般人が入り込んで草コインがどうのこうので爆死していったのを見たから同じことを繰り返してほしくないから書いてるで)}
他人の意見に左右されず自分の環境にあったグラボ/PCを買おうな(=もちろん90番台のグラボがベストなニキもいるってことや)。
- &size(20){迷ったらRTX 3060 12GBを買え}
万人向けのGPU。5万円程で比較的安価ながら、12GBのメモリを搭載していてそこそこの性能でAI用途ではコスパ最高。
もちろんゲームもFHDなら快適やで。

* 注意

** RTX40シリーズの注意事項

補助電源コネクタの異常発熱により融解することがある
[[NVIDIA公式の調査結果>>https://nvidia.custhelp.com/app/answers/detail/a_id/5413]]によると、コネクタが完全に挿入されていないことが原因
購入者はコネクタをしっかり差し込み、確認すべき

torch1系の場合、cudnnライブラリの更新をしないと速度が出ないっぽい。現在はTorch2が主流のため気にする必要はない。
[[ローカル高速化メモ]]

** メーカー・モデルによる差異

PC一般の知識ではあるが、同じ型番でもメーカー・モデルによって性能が異なる。
例えば、底辺のRTX4090だと最上位のRTX4080より低いベンチマークスコアを出すこともある。
特に組み立て済みPCでメーカー・モデルが明示されていない場合、一番安上がりのグラボを押し付けられる可能性が高い。
そもそも自作とBTOの差が縮まってきているとはいえ、それでも最上位だと10万以上上乗せされている。
ハイエンドほど自作推奨だが、どうしても組み立て済みPCを買う場合は、特にグラボについてはよく調べてから選んだほうがよい。

* SDXLについて
パラメータ数が約3倍になった影響でメモリ(メインメモリとビデオメモリの両方)の使用量も3倍近く増えた。
よってRTX 3060(12GB)以上かつメインメモリ32GB以上がおすすめ。ちなみに、FP8を利用するとVRAM消費が大幅に減って8GBでもまあまあ動く。

* パーツ評

** GPU

基本的にGPUの世代が新しく、メモリ帯域幅が多いほど生成が速くなる。
なお、メモリ容量やシェーダー数が多いからと言って速いわけではない(RTX3060が最たる例)。

RTX 2060 6GB以上を推奨。理由はFP16演算が速いから。
ベンチマークの結果もここで3倍程度の壁が出来ている。

学習は、処理速度もVRAMもあればあるだけ良い。
VRAM 8GBでも学習できるが解像度が欲しくなる。3060 12GBは評価が高い。

Radeon、Intel Arc、Macでも動作はするが新規購入はお勧めしない。
ケチるんならGeForce GTX 1000番台の中古。ただしRTX系のGPUより数倍遅いし、学習も厳しい。

ちなみにGeForce GTX 600番台(一部の780番等も該当)のKeplerやそれ以前のFermi世代はCUDAがサポート対象外で、LinuxでTorchを手動でビルド(エラーが発生しやすい)しないと使えないので注意。(誰もいないとは思うが...)

検証記事 [[【Stable Diffusion】AIイラストにおすすめなグラボをガチで検証【GPU別の生成速度】>>https://chimolog.co/bto-gpu-stable-diffusion-specs/]]

** RAM(メインメモリ)

モデルのマージ、WSL2、学習のいずれかに手を出すなら32GB以上が推奨。SDXLの学習は最低でも32GB必要。
速度はそこまでシビアではない。
RamDisk(仮想メモリ,スワップ領域)はほぼ意味ないが、SuperMergerのためにメモリを余分に(モデル3つ分くらい)積むのはアリ。また、RAMが少ないPCで発生するフリーズし続ける状況を一応回避できる。

生成だけならモデルの容量を小さくすることで節約が可能だし、無料Colabを使ってモデルを小さくする便利なNotebookもある。

生成だけなら8GBでもギリギリ動作するが、モデルデータの読み込み時や初回起動時にPCが一瞬か一定時間フリーズする。

** CPU

上位のGPUではCPUがボトルネックになる。
下位はSandyおじさんでも動いてるが多少遅い。DDR3世代だから？
推定12it/sまでは出せるのでGPUの性能ぎりぎり間に合ってるけど、次の生成開始に時間がかかってるのかも。

よほど古くない限り、Intel/AMDどちらでも問題ない。どっちでも何も変わらない。

GPU性能をフルに発揮し、処理中に他の作業がしたいなら、
iGPUつきのCPUにして、ブラウザ等はiGPUに割り振るのがおすすめ。
デスクトップCPUはIntelであれば末尾にFがついてないもの、AMDは末尾にGがついてるものとRyzen 7000シリーズがiGPUを搭載している。

GPUの性能が高いほどシングルスレッド性能によるボトルネックが出やすくなる
目安としてCinebench R23のシングルコアのスコア×0.0176でそのCPUの最大速度がわかる

** ストレージ

1111の起動時間が気になるなら出来るだけ速いNVMeのSSDがおすすめ。
待ってもいいならSATA SSDでも支障はない。
消耗はそこまで問題にならなくなったはず。
総書込量(TBW)を使い切る前に経年劣化で壊れるほうが多い。

バックアップを兼ねて2つ目のストレージを持っておくと安心。
コスパ的なおすすめは6〜8TBくらいのHDD。USBの外付けとかでもいいと思う。
速度重視のためにSSDオンリーにするのもいい。
モデルとデータセットについてはHuggingFace&#129303;が受け入れてくれる。
(プロバイダーによっては大容量アップロードで警告が来るらしいので注意？)

中華製品に抵抗がないなら、モンスターストレージが販売しているSSDがおすすめ。タイムセールで2TB,7450MB/sのSSDが1.3万円になってたりする。
AmazonとYahoo!ショッピングで販売中。

** OS

ガチでやるならLinuxは良い。
Windowsで普段使いするならWSL2も良い。
なお、Linuxだからといって速くなるとは限らない。

** クラウドとの併用

生成はローカル、学習はクラウドという構成もアリ

- LoraとHNの学習結果は容量が少ないのでクラウドからダウンロードしやすい
- 学習中は生成もゲームも出来なくなるし電気代もかかるのでクラウド化は合理的
- GPU買う前にまず無料Colabを試してみよう [[ローカルの学習入門]]

*実際の所どれ買えばいいの？

** A. お前の予算が許す限りのNVIDIAの上位モデルを買え

VRAM搭載量の違いから選択
[+]
-24GB越え製品
逸般の誤家庭向けでモデルを1から作る企業などの超本格的な人向け
入手ルート(販売ルート)も限られているしお値段も3桁万円とかする夢のモデル
このあたりのグラボを個人で使いたいならpaperspaceなどのクラウドコンピューティングが現実的。

-24GB製品
現実的な最高性能
値段は張るものの、画像生成やLoRA学習などでは下位の追随を許さない
次世代モデルが出ても多分安心

-16GBモデル
SDXLでも余裕で扱えるがその分値が張る
12GBモデルや旧型グラボからの乗換向きで、VRAM搭載量は安心感がある

-12GB製品
画像生成AIではデファクトスタンダード
SDXLも動かせる上に設定次第ではSDXL用LoRA作成も可能
初めて購入するなら値段もこなれているこのクラスから選択

-8GB製品
SD1.5は十分戦えたがSDXLだと低メモリ設定を入れる必要あり
LoRA学習もバッチを盛らなければできる。SDXLも--fp8_baseを使えばConvとTextEncoder込みで学習できる。
SDXLの普及を鑑みてVRAM12GB以上製品がおすすめ

-8GB未満製品
SD1.5でも低メモリ設定じゃないと動かない可能性が高い(どっちにしろVRAM8GB未満の製品は性能的にもキツイ)
SDXLはかなり絶望的。Fooocusでギリギリ動く程度。SD1.5のLoRAもギリギリ。
新規で購入する事はないと思うが、既に持っている人は買い換えの検討をお勧めする
[END]

現行モデル
[+]
- RTX 4090  [VRAM24GB]
3090Tiの1.5倍以上の性能をもつ次世代の化物
数多の重量級ゲームで4K100fps超えかレイトレ4k60fps出せる異次元の性能を誇る
そのスペックもさることながら、本体がとても大きいため冷却性能が優れており
高負荷でぶん回す生成AIと非常に相性が良い
30万円もするだけあって、あらゆる分野で最強
値上がりしたり下位グレードにSUPERが登場したりしても、絶対的な性能の高さのおかげでその地位は揺るがない。

- RTX 4080 SUPER  [VRAM16GB]
4080の強化版。消費電力そのまま性能が上がった。
価格据え置き性能アップ。

- RTX 4070Ti SUPER  [VRAM16GB]
4070Tiの強化版。消費電力そのまま性能が上がってVRAMが16GBに増えた。
4070Tiより少し高価な程度なのでコスパがいい…かも。

- RTX 4070Ti  [VRAM12GB]
RTX 4080からVRAMやCUDAコアを減らした廉価モデルで価格的にも性能的にも3080の後継モデル
3090Tiを越える性能を誇り3090より安価だが、VRAMが12GBなので高VRAM狙いだと少し残念。あと4Kゲーム性能が伸び悩み、3090Tiに負けるのも気になる。
VRAM12GBの3060以上の性能を求めて3080を考えている人なら、価格の近いこちらがお勧め

- RTX 4070(SUPER)  [VRAM12GB]
RTX 3080より少ない電力で同等の性能でより安い。VRAMは12GBあるのでLoRAの1024での学習もできる。
TGPは200Wで、2060S,2070Sからのアップグレードにおすすめ。強化版の4070 SUPERもあり。なお、コスパは改善してない。
もう少し値段が下がれば3060(12GB)の置き換えになる、かもしれない

- RTX 4060Ti(16GB)  [VRAM16GB]
SD1.Xと2.Xの環境では8GB版よりわずかに低性能なくせに1万円ほど高い。
しかしとにかくVRAM容量が物を言うSDXLでは場面によっては4070Tiより高速になる。
SDXLを使うなら十分選択肢に入る。
ゲーム性能優先ならより安くて高性能な4070を買ったほうが幸せになれる。
RTX 4060Ti(8GB)版と間違えないように注意

- RTX 4060  [VRAM8GB]
VRAMが8GBで性能も3060と3060Tiの間といった進化に乏しい超微妙スペック。
とはいえTGPがわずか110Wなのが魅力的で、PCの用途がゲームメインでAIは軽く遊ぶ程度なら十分アリ。
SDXLもFooocusやfp8の1111やStable Diffusion WebUI Forgeを使えばVRAM不足にならずに動作する。
ゲーム性能とAI性能のバランスをとるなら3060 12GBがおすすめ。

- RTX 3060(12GB)
迷ったらとりあえずこれ買おう
性能こそ平凡だが、VRAMが12GBもあるのでSD1.Xは余裕でXLもまあまあ動く
フルHDであれば最新のゲームも快適
ちなみにPS5とほぼ同じ位のスペック
後述の8GB版と間違えて買わないように注意

[END]

現在おすすめできないグラボ
[+]
- RTX 4080
NVIDIAは4080の製造を終了したらしく新品が販売される時間もそう長くない。
4080 SUPERを買いましょう。

- RTX 4060Ti(8GB)
ゲーム用途でも3070Tiに勝ったり負けたり、物によっては3060Tiにも勝ったり負けたりの超微妙スペック。
性能的にも価格的にも、これを選ぶなら3060 12GB を選びましょう。

- RTX 3090Ti
性能とワッパで4090どころか4080にすらボロ負け
VRAM24GB欲しいなら4090か中古の3090を買え

- RTX 3090
VRAM24GBの前世代の化け物
値段相応のスペックを持ち、VRAM12GB以上を狙うならこれ一択
ゲームでもAI学習でも何でも十分にこなす優等生
中古で10万円前後ならあり。

- RTX 3080Ti,3080
もう新品はほとんど売ってないし高いので4070,4070tiを買おう。RTX4000シリーズは電力効率が良く発熱も少ないのでおすすめ。
中古なら、マイニング落ちの10GBに釣られてLHR対応の12GB版の中古がかなり安い。

- RTX 3070、RTX 3070Ti
ワッパを考慮して4060Tiを買いましょう。
4K60fpsも可能だが、DLSSがないと安定して60fpsを出せず、絶妙な性能不足を感じるシーンが多い。
快適な4KゲーミングやVR目的なら4070を買った方が良い。

- RTX 3060Ti
3070より遅くて3060よりVRAMが少ない中途半端な存在。3060 12GBでいい。

- RTX 3060(8GB)
''絶対に買うな''
最近出てきた新型だが、''VRAMが8GBに減ってしまった''罠モデル。
ゲームをするなら4060Ti(8GB)、AI目的なら3060(12GB)がお勧め

- RTX 3050
自分を最新版超絶性能グラボだと思い込んでいるGTX 1660Ti
とりあえずグラボを乗せたい人向け。
今更新規に買う価値は無いしVRAM6GBのモデルに置き換えられた。さすがに4060買ったほうがいい。

- GeForce GTXシリーズ全般
AI処理に特化したTensorコアがないためとても遅い。出力結果がRTXと大きく異なることがある。

- (番外編)RTX A4000
''VRAM16GB''で実売価格でRTX 3080Ti程度(?)で手に入る(3DCG等の)''クリエイター向けGPU''。
実売価格の割にゲーム用途ではやや弱い(概ねRTX 3060〜3060Tiの間くらい)が''1スロット''且つ''140Wという驚異のワッパ''を兼ね備える。
''元々ゲーム・一般ユーザ向けじゃない''ためパーツ屋に行っても置いてないのが基本。買うなら通販など調べよう。
一般的なゲームとの相性はあまり良くないがVRCなどではVRAMのお陰で快適らしい。
繰り返すが''元々ゲーム・一般ユーザ向けじゃない''。入手手段から固有の問題まで自己解決できる自信のある上級者向け。

- IntelとAMD製GPU
TorchがNVIDIAに最適化されているため、他メーカーのGPUではイマイチ性能が伸びない。
ちなみに、RadeonはROCmのWindows版の登場してPyTorchが対応したにもかかわらず、まだWindows向けビルドが出てない。
Intelは一部機能が非対応だったりするので論外。
[END]

** A. どれを買うかで迷ってるなら3060 12GBを買え
[+]
理由は5つ。
- 法外というほどの高額じゃない(※個人の感想です)
- VRAMあたりのコスパとワッパがいい。650W電源くらいで動く。
- 学習するのにVRAMが必要だから。今は興味なくても後でしたくなるかも知れない。
- 生成する時に高解像度で出したくなるかも知れないから。Highres. fix
- VRAM容量的にこれがダメなら3090や4060Ti(16GB)が必要になるから。

TDPなどスペックの参考に
https://wikiwiki.jp/nvidiavga/GPU%E4%BB%95%E6%A7%98%E4%B8%80%E8%A6%A7%E8%A1%A8

RTX 3060(12GB)搭載PCは、PCショップで13万前後で買えるがさすがに型落ちなので搭載PCが減っている。GPU単体なら4万円前後。
13万出すなら有名なショップで新品買ったほうがいいと思うぞ。
間違って3060 8GBを買わないように。3060Tiも8GBだから損。
起動時とモデルマージ時にメインメモリを激しく消費するので、なんとかして32GBに増設したほうが安心。
[END]

** A. 3050 8GBを検討？
''VRAM6GBのモデルに置き換えられた。''6GBではSD1.5が精一杯でSDXLと重量級ゲームは厳しい。
3060(12GB)か4060(8GB)を買いましょう。

[+]
- LoRAの登場でVRAM 8GBがギリ人権を得られる
- 3060の1.5倍待てば済むんなら・・・待てない？
- 8GBあればmedvram無しでも1024x768くらいは余裕
- 生成される画像が違う？(検証求む)
- 新品の2000番台はもう無いので3050が最下限になる
> NVIDIAは、GeForce GTX 1660、GTX 1660 SUPER、RTX 2060、RTX 2060 SUPERの4製品の製造を終了した。

中古なら2060 12GB、2060S(8GB)もアリ。
1060とか1660Tiは数倍遅くなるのでVRAM容量を置いといてもナシかな。
とはいえ1060とか1660Tiから3050に買い換えるのも悲しいけど。
[END]

** A. 学習するかどうかから考えて買え
[+]
-学習はLoRAだけする
VRAM8GBのモデルのうち予算内の上位モデルを狙おう
候補：RTX 3070,3070Ti,4060Ti(8GB),4060

-学習にちょっと興味があるか、FHD以上の解像度で生成したい
VRAM12GBのモデルを選ぼう
候補：3060(12GB)・4070(SUPER)・4070Ti

-学習に大変興味がある
VRAM16GB以上のモデルを選ぼう
候補：3090、4090、4080 SUPER、4060Ti(16GB)、4070Ti SUPER
[END]

** 中古のグラボ買っても大丈夫？
[+]
基本的には推奨しない。
中古に流れているグラボの大半は、マイニングに使われてたと言われている。
マイニングはグラボの性能を全力で使う為、熱の影響でコンデンサや他のパーツが劣化してる可能性がある。つまり故障しやすい。
マイニングに不向きなLHR版(Lite Hash Rate)のグラボもあるので、そちらを買うと多少マシと言われている。
[END]

** ゲーミングノートパソコンをお勧めできない理由
[+]
Stable Diffusion webUIはマイニング並みに使用率100パーセントに張り付いた状態でグラボを酷使する
''ノートパソコンごときの冷却性能では全く冷えない''上にファンがうるさい

3070ならVRAM 8GBでデスクトップと同じになるが、
予算としては3060 12GB搭載デスクトップより高くなる。

3080や3080TiにはVRAM 16GBモデルがあり魅力的だが、
どんなに安くても30万円台なので、もう少し足せば4080搭載デスクトップに手が届く。

冷却性能の悪さやノートパソコン特有のGPU性能低下は、
寝てる間に絵を量産したり学習に丸一日かけてた時代が終わったこともあって、
AIではそこまで大きな問題にならないが、単純にコスパは悪い。
[END]

** 中古の1000番台なら
[+]
コスパは1070が一番いいと思う。
FP16対応が限定的なのでVRAMを食う。
CPUをケチってiGPUが無いのでVRAMを食う。
というわけでVRAMは多めに欲しい。
1080とは大差ないが、1060だとかなり遅くなる。
とはいえSDXLが普及してきた今はGTX世代は中古でもなしかな。
[END]

** ローエンドGPUのVRAMと画像サイズ
[+]
FHDでHighres, fixしたかったら3060がおすすめやでー

PCの使用状況やライブラリ,ドライバのバージョンによって変化する。
モデルを小さくしてVAEを交換すれば高解像度を狙える。プログレスバーが100%あたりでCUDA OOMするときはMultiDiffusionのTiled VAEを使うといい。
|~VRAM|Options|最大WxH|
|4GB|lowvram|512x768|
|6GB|medvram xformers|1536x1024|
|8GB|xformers|1920x1088 1472x1472|
最大WxHを超えると出力画像が真っ黒(NansException)になるか、(設定によっては)メモリ不足でエラーになる。
NVIDIAのドライバ535.98あたりから共有メモリも使うようになって上限が上がった模様。''ただしVRAMが溢れた状態ではlowvram並みに遅くなる。''

VRAMを溢れさせたくない(共有GPUメモリを利用したくない)場合はNvidiaコンパネから3D設定の管理に進み、
プログラムに"C:\Users\ユーザー名\AppData\Local\Programs\Python\Python3XX\python.exe"を指定した上で「CUDA - System Fallback Policy」を ''Prefer No System Fallback''にすれば解消する。
詳細:[[System Memory Fallback for Stable Diffusion>https://nvidia.custhelp.com/app/answers/detail/a_id/5490]]

medvramはだいたい所要時間1.5倍くらい
lowvramはさらに4〜10倍くらい
[END]

